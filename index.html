<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Analizador de Funciones</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.min.js"></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f4f4f4; color: #222; }
    input, button { padding: 10px; width: 100%; font-size: 16px; margin-bottom: 10px; }
    code { background: #eaeaea; padding: 3px 6px; border-radius: 4px; }
    table { width: 100%; max-width: 400px; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #999; padding: 6px; text-align: center; }
    pre { background: #f9f9f9; padding: 10px; overflow-x: auto; white-space: pre-wrap; }
    #graph { margin-top: 20px; }
  </style>
</head>
<body>

<h1>Analizador de Funciones</h1>
<input type="text" id="inputFunc" placeholder="Ejemplo: 1 / (x + 2)">
<button onclick="analizarFuncion()">Analizar</button>

<h2>Resultados</h2>
<p><strong>Dominio:</strong> <code id="dominio"></code></p>
<p><strong>Rango:</strong> <code id="rango"></code></p>
<p><strong>Asíntotas Verticales:</strong> <code id="asintotasV"></code></p>
<p><strong>Asíntotas Horizontales:</strong> <code id="asintotasH"></code></p>
<h3>Tabla de valores</h3>
<table><thead><tr><th>x</th><th>f(x)</th></tr></thead><tbody id="tabla"></tbody></table>
<div id="graph"></div>

<script>
function analizarFuncion() {
  const input = document.getElementById("inputFunc").value.trim();
  const expr = math.parse(input);
  const compiled = math.compile(input);
  let dominioStr = "D = { x ∈ ℝ";
  let rangoStr = "";
  let tablaHTML = "";
  let asintotasV = [];
  let excluidos = [];
  let minY = Infinity, maxY = -Infinity;
  let puntosX = [-10, -8, -5, -3, -2.1, -1, 0, 1, 3, 5]; // 10 puntos
  let puntosY = [];

  // Detectar valores excluidos del dominio (divisiones por 0)
  expr.traverse(node => {
    if (node.type === "OperatorNode" && node.op === "/") {
      try {
        let denom = node.args[1];
        let eq = math.simplify(denom).toString();
        let soluciones = math.evaluate(`solve(${eq} = 0, x)`);
        soluciones = Array.isArray(soluciones) ? soluciones : [soluciones];
        soluciones.forEach(s => {
          excluidos.push(s.toString());
          asintotasV.push(`x = ${s.toString()}`);
        });
      } catch {}
    }
  });

  if (excluidos.length > 0) {
    dominioStr += ", x ≠ " + excluidos.join(" y x ≠ ");
  }
  dominioStr += " }";

  // Tabla de valores
  puntosX.forEach(x => {
    let y;
    try {
      y = compiled.evaluate({ x });
      if (!isNaN(y) && Math.abs(y) < 1e6) {
        y = math.round(y, 5);
        puntosY.push(y);
        minY = Math.min(minY, y);
        maxY = Math.max(maxY, y);
        tablaHTML += `<tr><td>${x}</td><td>${y}</td></tr>`;
      } else {
        tablaHTML += `<tr><td>${x}</td><td>undefined</td></tr>`;
      }
    } catch {
      tablaHTML += `<tr><td>${x}</td><td>undefined</td></tr>`;
    }
  });

  // Asíntota horizontal (límite en ±∞)
  let ah = null;
  try {
    const limPos = compiled.evaluate({ x: 1e6 });
    const limNeg = compiled.evaluate({ x: -1e6 });
    if (Math.abs(limPos - limNeg) < 1e-2) {
      let limite = math.round((limPos + limNeg) / 2, 5);
      ah = `y = ${limite}`;
    }
  } catch {}

  // Rango simbólico para funciones racionales tipo 1/(x + a)
  if (/^1\s*\/\s*\(x\s*[+\-]\s*\d+\)$/.test(input.replace(/\s+/g, ""))) {
    rangoStr = "R = { y | y ∈ ℝ, y ≠ 0 }";
  } else {
    rangoStr = `R ≈ { y ∈ ℝ | ${math.round(minY, 5)} ≤ y ≤ ${math.round(maxY, 5)} }`;
  }

  // Mostrar resultados
  document.getElementById("dominio").textContent = dominioStr;
  document.getElementById("rango").textContent = rangoStr;
  document.getElementById("asintotasV").textContent = asintotasV.length ? asintotasV.join(", ") : "Ninguna";
  document.getElementById("asintotasH").textContent = ah || "Ninguna";
  document.getElementById("tabla").innerHTML = tablaHTML;

  // Gráfica
  let layout = {
    title: "Gráfica de la función",
    xaxis: { title: "x" },
    yaxis: { title: "f(x)" },
    shapes: []
  };
  if (ah) {
    const yVal = parseFloat(ah.split("=")[1]);
    layout.shapes.push({
      type: "line", x0: -10, x1: 10, y0: yVal, y1: yVal,
      line: { color: "blue", dash: "dashdot" }
    });
  }
  excluidos.forEach(x => {
    const xVal = parseFloat(x);
    if (!isNaN(xVal)) {
      layout.shapes.push({
        type: "line", x0: xVal, x1: xVal, y0: minY, y1: maxY,
        line: { color: "red", dash: "dot" }
      });
    }
  });

  Plotly.newPlot("graph", [{
    x: puntosX,
    y: puntosY,
    mode: "lines+markers",
    marker: { color: "orange" },
    line: { color: "green" }
  }], layout);
}
</script>

</body>
</html>
